<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
  <style>
    .message-ball {
      font-size: 20px;
      line-height: 200px;
      text-align: center;
      font-weight: bold;
      font-style: oblique;
    }

    .circle {
      transition-property: width, height, margin-left, margin-top;
      transition-duration: 2s;
      position: fixed;
      transform: translateX(-50%) translateY(-50%);
      background-color: yellow;
      border-radius: 50%;
    }
  </style>
</head>

<body>
  <button onclick="go()">Show circle</button>
  <script type="text/javascript">
    // Promise.all([
    //   new Promise(resolve => setTimeout(() => resolve(1), 3000)),
    //   new Promise(resolve => setTimeout(() => resolve(2), 2000)),
    //   new Promise(resolve => setTimeout(() => resolve(3), 1000))
    // ]).then(alert)

    //example to fetch URL
    // let urls = [
    //   'https://api.github.com/users/iliakan',
    //   'https://api.github.com/users/remy',
    //   'https://api.github.com/users/jeresig'
    // ];
    //map every url to the Promise fetch
    // let request = urls.map(url => fetch(url));
    //
    //
    // Promise.all(request)
    // .then(responses => responses.forEach(response => alert(`${response.url}: ${response.status}`)));

    // let names = ['iliakan', 'remy', 'jeresig'];
    // let requests = names.map(name => fetch(`https://api.github.com/users/${name}`));
    //
    // Promise.all(requests)
    // .then(responses => {
    //   for(let response of responses){
    //     alert(`${response.url}: ${response.status}`);
    //   }
    //   return responses;
    // })
    // .then(responses => Promise.all(responses.map(r => r.json())))
    // .then(users => users.forEach(user => alert(user.name)));

    // Promise.all([
    //   new Promise((resolve, reject) => setTimeout(() => resolve(1), 1000)),
    //   new Promise((resolve, reject) => setTimeout(() => reject(new Error("whoops!")), 2000)),
    //   new Promise((resolve, reject) => setTimeout(() => resolve(3), 3000))
    // ]).catch(alert);


    // Promise.allSettled
    // let urls = [
    //   'https://api.github.com/users/iliakan',
    //   'https://api.github.com/users/remy',
    //   'https://no-such-url'
    // ];

    // Promise.allSettled(urls.map(url => fetch(url)))
    //   .then(results => {
    //     results.forEach((result, num) => {
    //       if (result.status === 'fullfilled') {
    //         alert(`${urls[num]}: ${result.value.status}`);
    //       }
    //       if (result.status === 'rejected') {
    //         alert(`${urls[num]}: ${result.reason}`)
    //       }
    //     })
    //   })

    // Promise.allSettled(urls.map(url => fetch(url)))
    //   .then(results => { // (*)
    //     results.forEach((result, num) => {
    //       if (result.status == "fulfilled") {
    //         alert(`${urls[num]}: ${result.value.status}`);
    //       }
    //       if (result.status == "rejected") {
    //         alert(`${urls[num]}: ${result.reason}`);
    //       }
    //     });
    //   });

    // Promise.race()
    // Promise.race([
    //   new Promise((resolve, reject) => setTimeout(() => resolve(1), 2000)),
    //   new Promise((resolve, reject) => setTimeout(() => reject(new Error('Whoops!')),2000)),
    //   new Promise((resolve, reject) => setTimeout(() => resolve(3), 1000))
    // ]).then(alert);


    // let p2 = Promise.allSettled([Promise.resolve(1), Promise.reject(2), 3]).then(result => {
    //   result[0],
    //   result[1],
    //   result[2]
    // })
    //
    // setTimeout(console.log,0,p2);

    // let promise = new Promise(function(resolve, reject){
    //   setTimeout(() => resolve("done"),3000);
    // })

    // let promise = new Promise(function(resolve, reject) {
    //   setTimeout(() => resolve("done"), 3000);
    // })

    // let promise = new Promise(function(resolve, reject) {
    //   setTimeout(() => reject(new Error("Whoops")),3000)
    // })

    // promise.then(
    //   result => alert(result),
    //   error => console.log(error)
    // )

    // promise.catch(alert);

    // new Promise((resolve, reject) => {
    //   setTimeout(() => resolve("result"), 2000)
    // })
    // .finally(() => alert("Promise ready"))
    // .then(result => alert(result))

    // new Promise((resolve, reject) => {
    //   throw new Error("error");
    // })
    // .finally(() => console.log("Promise ready"))
    // .catch(err => console.log(err))

    // function loadScript(src) {
    //   return new Promise(function(resolve, reject) {
    //     let script = document.createElement('script');
    //     script.src = src;
    //     script.onload = () => resolve(script);
    //     script.onerror = () => reject(new Error(`Script on load error for ${src}`));
    //     document.head.append(script);
    //   })
    //
    //   let promise = loadScript("https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.11/lodash.js");
    //   promise.then(script => alert('One more handler to do something else!'));
    // }


    // Re resolve a promise
    // jawabannya adalah 1, karena promise hanya mengeluarkan satu output
    // let promise =  new Promise((resolve, reject) => {
    //     resolve(1);
    //     setTimeout(() => resolve(2),3)
    // });
    //
    // promise.then(alert);

    // delay with a promise
    // function delay(ms) {
    //   return new Promise((resolve, reject) => {
    //     setTimeout(() => resolve(), ms);
    //   })
    // }
    //
    // delay(3000).then(() => alert("runs after 3 seconds"))

    // animated circle with promise
    function go() {
      showCircle(150, 150, 100).then(div => {
        div.classList.add('message-ball');
        div.append("Hello World javascript");
      });
    }


    function showCircle(cx, cy, radius) {
      let div = document.createElement('div');
      div.style.width = 0;
      div.style.height = 0;
      div.style.left = cx + 'px';
      div.style.top = cy + 'px';
      div.className = 'circle';
      document.body.append(div);

      return new Promise(resolve => {
        setTimeout(() => {
          div.style.width = radius * 2 + 'px';
          div.style.height = radius * 2 + 'px';
          div.addEventListener('transitionend', function handler() {
            div.removeEventListener('transitionend', handler);
            resolve(div);
          })
        }, 0);
      })
    }
  </script>
</body>

</html>
